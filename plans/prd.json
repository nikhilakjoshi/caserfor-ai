[
  {
    "category": "backend",
    "description": "Replace mockVaults in assistant page with GET /api/vaults call",
    "steps": [
      "Open app/(dashboard)/assistant/page.tsx",
      "Remove mockVaults array",
      "Fetch vaults from GET /api/vaults on modal open",
      "Map API response to vault list UI"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Replace mockVaultsWithFiles with GET /api/vaults/[id]/documents call",
    "steps": [
      "Open app/(dashboard)/assistant/page.tsx",
      "Remove mockVaultsWithFiles array",
      "Fetch documents from GET /api/vaults/[id]/documents on vault click",
      "Map API response to file list UI"
    ],
    "passes": true
  },
  {
    "category": "ui",
    "description": "Add loading and error states to vault selection modal",
    "steps": [
      "Show spinner while fetching vaults",
      "Show spinner while fetching vault documents",
      "Display error message on fetch failure",
      "Allow retry on error"
    ],
    "passes": true
  },
  {
    "category": "ui",
    "description": "Resize vault selection modal to 90vw x 90vh",
    "steps": [
      "Update modal container dimensions to 90vw x 90vh",
      "Center modal on screen",
      "Verify modal is responsive"
    ],
    "passes": true
  },
  {
    "category": "ui",
    "description": "Update vault selection modal grid to 3 columns with two-state view",
    "steps": [
      "Create vault list state with 3-column grid of vault cards",
      "Each card shows name, type badge, file count, description",
      "Create vault detail state with file table and checkboxes",
      "Add back navigation from detail to list",
      "Add selected files summary bar with Add to Chat CTA",
      "Add smooth transitions between states"
    ],
    "passes": true
  },
  {
    "category": "ui",
    "description": "Add search/filter in vault selection modal (both states)",
    "steps": [
      "Add search input to vault list view",
      "Filter vault cards by name/description on input",
      "Add search input to vault detail file table",
      "Filter files by name on input"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Replace mock data in /vault page with GET /api/vaults",
    "steps": [
      "Open app/(dashboard)/vault/page.tsx",
      "Remove mock vault data",
      "Fetch from GET /api/vaults",
      "Render vault list from API response"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Replace mock data in /vault/[id] page with GET /api/vaults/[id]/documents",
    "steps": [
      "Open app/(dashboard)/vault/[id]/page.tsx",
      "Remove mock document data",
      "Fetch from GET /api/vaults/[id]/documents",
      "Render document list from API response"
    ],
    "passes": true
  },
  {
    "category": "ui",
    "description": "Add loading, empty, and error states to vault pages",
    "steps": [
      "Add loading skeleton to /vault page",
      "Add loading skeleton to /vault/[id] page",
      "Add empty state when no vaults/documents exist",
      "Add error state with retry on fetch failure"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Install AWS SDK v3 packages",
    "steps": [
      "Run npm install @aws-sdk/client-s3 @aws-sdk/s3-request-presigner",
      "Verify packages in package.json"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Create lib/s3.ts with S3 client singleton and helpers",
    "steps": [
      "Create lib/s3.ts",
      "Initialize S3Client singleton with env vars",
      "Export uploadFile helper (key format: vaults/{vaultId}/{uuid}.{ext})",
      "Export getPresignedUrl helper",
      "Export deleteFile helper"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Add AWS env vars to .env.example",
    "steps": [
      "Add AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY, AWS_REGION, AWS_S3_BUCKET to .env.example"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Update upload API to store files in S3 instead of base64",
    "steps": [
      "Modify document upload API endpoint",
      "Upload file buffer to S3 via lib/s3.ts",
      "Store S3 key in Document.storageKey",
      "Remove base64 storage from metadata",
      "Return document record with storageKey"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Add server-side 25MB file size validation to upload API",
    "steps": [
      "Check request body/file size in upload endpoint",
      "Return 413 if file exceeds 25MB",
      "Include descriptive error message"
    ],
    "passes": true
  },
  {
    "category": "ui",
    "description": "Add client-side 25MB file size validation on assistant page",
    "steps": [
      "Check file size before upload in assistant page file input",
      "Show error toast/message if file exceeds 25MB",
      "Prevent upload from proceeding"
    ],
    "passes": true
  },
  {
    "category": "ui",
    "description": "Add client-side 25MB file size validation on vault detail page",
    "steps": [
      "Check file size before upload in vault detail page file input",
      "Show error toast/message if file exceeds 25MB",
      "Prevent upload from proceeding"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Create presigned URL endpoint for S3 download/preview",
    "steps": [
      "Create app/api/vaults/[id]/documents/[docId]/presign/route.ts",
      "Accept GET request with document ID",
      "Look up Document.storageKey from DB",
      "Generate presigned URL via lib/s3.ts",
      "Return presigned URL in response"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Install embedding pipeline dependencies",
    "steps": [
      "Run npm install @pinecone-database/pinecone pdf-parse mammoth",
      "Verify packages in package.json"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Create lib/pinecone.ts with Pinecone client and helpers",
    "steps": [
      "Create lib/pinecone.ts",
      "Initialize Pinecone client singleton with PINECONE_API_KEY",
      "Export upsertVectors helper (batch 100 per upsert)",
      "Export queryVectors helper with namespace and filter support",
      "Export deleteVectors helper",
      "Use namespace format: vault-{vaultId}"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Add Pinecone env vars to .env.example",
    "steps": [
      "Add PINECONE_API_KEY and PINECONE_INDEX to .env.example"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Create lib/document-parser.ts for text extraction",
    "steps": [
      "Create lib/document-parser.ts",
      "Export extractText function",
      "Handle PDF via pdf-parse",
      "Handle DOCX via mammoth",
      "Handle TXT via direct read",
      "Return extracted text string"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Create lib/chunker.ts for text chunking with overlap",
    "steps": [
      "Create lib/chunker.ts",
      "Export chunkText function",
      "Split text into ~1000 token chunks with 200 token overlap",
      "Return array of { text, chunkIndex } objects"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Create lib/embeddings.ts and add embeddingModel to lib/ai.ts",
    "steps": [
      "Add embeddingModel export to lib/ai.ts using google.textEmbeddingModel('text-embedding-004')",
      "Create lib/embeddings.ts",
      "Export embedChunks function using AI SDK embedMany()",
      "Return array of vectors (768 dims)"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Add chunkCount and embeddedAt fields to Document schema + migrate",
    "steps": [
      "Add chunkCount Int? to Document model in schema.prisma",
      "Add embeddedAt DateTime? to Document model in schema.prisma",
      "Run prisma migrate to apply changes",
      "Verify migration succeeds"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Create embed API endpoint triggered after upload",
    "steps": [
      "Create app/api/vaults/[id]/documents/process/route.ts",
      "Accept POST with documentId",
      "Set embeddingStatus to PROCESSING",
      "Download file from S3, extract text via document-parser",
      "Chunk text via chunker.ts",
      "Embed chunks via embeddings.ts",
      "Upsert vectors to Pinecone with metadata (documentId, chunkIndex, text, documentName, documentType)",
      "Update Document: embeddingStatus=COMPLETED, chunkCount, embeddedAt",
      "On error: set embeddingStatus=FAILED",
      "Trigger non-blocking from upload endpoint"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Define EB1A categories constant with all 18 categories",
    "steps": [
      "Create lib/document-categories.ts",
      "Define DOCUMENT_CATEGORIES array with 10 EB1A + 8 general categories",
      "Include slug, label, and description for each",
      "Export as const"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Create AI categorization endpoint using generateObject()",
    "steps": [
      "Create categorize function or endpoint",
      "Use Vercel AI SDK generateObject() with structured output",
      "Input: first ~3000 tokens of document text + filename",
      "Output schema: { category: enum, confidence: number, reasoning: string }",
      "Return categorization result"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Trigger AI categorization after document upload (non-blocking)",
    "steps": [
      "Call categorization from process endpoint alongside embedding",
      "Store category in Document.documentType",
      "Store confidence + reasoning in Document.metadata",
      "Preserve original AI category in metadata.aiCategory on override"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Create PATCH endpoint for document updates (category override)",
    "steps": [
      "Create app/api/vaults/[id]/documents/[docId]/route.ts",
      "Accept PATCH with updated fields (documentType, etc.)",
      "Preserve original AI category in metadata.aiCategory",
      "Update Document record",
      "Return updated document"
    ],
    "passes": true
  },
  {
    "category": "ui",
    "description": "Add category override UI and category select in create vault modal",
    "steps": [
      "Add category dropdown to document row in vault detail page",
      "Populate dropdown from DOCUMENT_CATEGORIES constant",
      "On change, PATCH /api/vaults/[id]/documents/[docId]",
      "Show current category badge on each document row",
      "Add category select option in create vault modal if applicable"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Create lib/rag.ts query helper for RAG retrieval",
    "steps": [
      "Create lib/rag.ts",
      "Export queryRelevantChunks function",
      "Embed user query via embeddings.ts",
      "Query Pinecone filtered by document IDs",
      "Return top-K chunks (K=10) with metadata"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Inject RAG context into /api/assistant/query endpoint",
    "steps": [
      "Modify /api/assistant/query to accept attachedFiles with source type",
      "For vault files: call lib/rag.ts to get relevant chunks",
      "For uploaded files: extract text inline, chunk as ephemeral context",
      "Inject retrieved chunks into system prompt"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Add citation instruction to system prompt for RAG responses",
    "steps": [
      "Append citation format instructions to system prompt when RAG context present",
      "Instruct AI to use [docName, p.X] citation format",
      "Each citation must reference document ID + chunk index"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Return source document references in query response",
    "steps": [
      "Include source documents array in API response",
      "Each source: documentId, documentName, chunkIndex, text snippet",
      "Store references in SourceReference table"
    ],
    "passes": true
  },
  {
    "category": "ui",
    "description": "Parse and display citations in chat UI as clickable links",
    "steps": [
      "Parse [docName, p.X] citations from AI response text",
      "Render citations as clickable badges/links",
      "On click, open document viewer at cited location",
      "Style citations distinctly from regular text"
    ],
    "passes": true
  },
  {
    "category": "ui",
    "description": "Install react-pdf for document preview",
    "steps": [
      "Run npm install react-pdf",
      "Verify package in package.json",
      "Configure Next.js for react-pdf if needed (webpack config for pdf.worker)"
    ],
    "passes": true
  },
  {
    "category": "ui",
    "description": "Create DocumentViewer component for PDF and text preview",
    "steps": [
      "Create components/vault/document-viewer.tsx",
      "Render PDFs via react-pdf with page navigation",
      "Render DOCX/TXT as formatted text",
      "Add zoom controls and download button",
      "Support jumping to specific page via props",
      "Support text highlight/scroll for citation navigation"
    ],
    "passes": true
  },
  {
    "category": "ui",
    "description": "Add document preview to vault detail page",
    "steps": [
      "Add click handler on document rows in vault detail page",
      "Open DocumentViewer in side panel or modal on click",
      "Pass presigned URL to viewer",
      "Close viewer on dismiss"
    ],
    "passes": true
  },
  {
    "category": "ui",
    "description": "Make chat citation badges open DocumentViewer at cited location",
    "steps": [
      "On citation click in chat, fetch presigned URL for document",
      "Open DocumentViewer with target page/passage",
      "Highlight cited text passage in viewer"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Create status polling API for document processing status",
    "steps": [
      "Ensure GET /api/vaults/[id]/documents returns embeddingStatus per document",
      "Include status field: PENDING, PROCESSING, COMPLETED, FAILED",
      "Optionally create per-document status endpoint"
    ],
    "passes": true
  },
  {
    "category": "ui",
    "description": "Add status polling in vault detail page for processing documents",
    "steps": [
      "Poll GET /api/vaults/[id]/documents every 3-5 seconds",
      "Only poll while any document is PENDING or PROCESSING",
      "Stop polling when all documents COMPLETED or FAILED",
      "Update document list on each poll response"
    ],
    "passes": true
  },
  {
    "category": "ui",
    "description": "Style processing status badges on document rows",
    "steps": [
      "Show PENDING badge (neutral/gray)",
      "Show PROCESSING badge (blue/animated)",
      "Show COMPLETED badge (green)",
      "Show FAILED badge (red)"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Create retry endpoint and retry button for failed documents",
    "steps": [
      "Create POST /api/vaults/[id]/documents/[docId]/retry endpoint",
      "Reset embeddingStatus to PENDING",
      "Re-trigger processing pipeline",
      "Add retry button on FAILED document rows in UI",
      "On click, call retry endpoint and resume polling"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Add Agent model to Prisma schema",
    "steps": [
      "Add Agent model (id, userId, name, slug, description, instruction, createdAt, updatedAt)",
      "Add unique constraint on (userId, slug)",
      "Run prisma migrate"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Create POST /api/agents (create agent)",
    "steps": [
      "Accept name/description/instruction",
      "Auto-generate slug from name (lowercase, hyphens)",
      "Validate slug uniqueness per user",
      "Validate non-empty fields",
      "Save to DB, return agent"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Create GET /api/agents (list agents)",
    "steps": [
      "Filter by userId",
      "Order by updatedAt desc",
      "Return agent array"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Create GET /api/agents/[id] (get agent)",
    "steps": [
      "Fetch by id + userId",
      "Return 404 if not found"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Create PUT /api/agents/[id] (update agent)",
    "steps": [
      "Validate fields",
      "Re-generate slug if name changed",
      "Check slug uniqueness excluding self",
      "Update record"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Create DELETE /api/agents/[id] (delete agent)",
    "steps": [
      "Delete by id + userId",
      "Return 204"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Create POST /api/agents/test (test console backend)",
    "steps": [
      "Accept instruction + messages array",
      "Use instruction as system prompt",
      "Stream LLM response via Vercel AI SDK",
      "No DB persistence"
    ],
    "passes": true
  },
  {
    "category": "ui",
    "description": "Create /agents route with agent list page",
    "steps": [
      "Card layout showing name/description/updatedAt",
      "Create New Agent button",
      "Edit and delete actions",
      "Loading/empty/error states"
    ],
    "passes": false
  },
  {
    "category": "ui",
    "description": "Add /agents to app sidebar navigation",
    "steps": [
      "Add nav item to app-sidebar.tsx",
      "Match existing nav style"
    ],
    "passes": false
  },
  {
    "category": "ui",
    "description": "Create /agents/new route with creation form",
    "steps": [
      "Name input (free-form)",
      "Description textarea",
      "Instruction textarea (multiline)",
      "Inline validation",
      "Save button disabled until valid",
      "Success toast, redirect to list"
    ],
    "passes": false
  },
  {
    "category": "ui",
    "description": "Create /agents/[id]/edit route with edit form",
    "steps": [
      "Pre-populate from GET /api/agents/[id]",
      "Same validation as create",
      "Save via PUT",
      "Unsaved changes warning on navigate away"
    ],
    "passes": false
  },
  {
    "category": "ui",
    "description": "Add delete confirmation dialog",
    "steps": [
      "Confirm dialog before DELETE",
      "Remove from list on success",
      "Error toast on failure"
    ],
    "passes": false
  },
  {
    "category": "ui",
    "description": "Build agent test console component",
    "steps": [
      "Chat-style interface with input + message list",
      "Send to POST /api/agents/test with current instruction + full message history",
      "Stream response",
      "Multi-turn conversation support"
    ],
    "passes": false
  },
  {
    "category": "ui",
    "description": "Integrate test console into create/edit pages",
    "steps": [
      "Side-by-side layout (config left, console right)",
      "Console activates when all fields filled",
      "Reset conversation when instruction changes"
    ],
    "passes": false
  },
  {
    "category": "ui",
    "description": "Style agent pages per global design",
    "steps": [
      "0 shadows",
      "0-4px border radius",
      "bg-gray-50 cards/panels",
      "White text fields",
      "Minimal buttons"
    ],
    "passes": false
  }
]